<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBDPN0hk9ZZbOdeHirFz2z_M8XGmNMpPVk",
        authDomain: "soundly-e318d.firebaseapp.com",
        projectId: "soundly-e318d",
        storageBucket: "soundly-e318d.firebasestorage.app",
        messagingSenderId: "452438627644",
        appId: "1:452438627644:web:62bdebcad4b145e3883a39"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ВРЕМЯ МСК ДЛЯ БАЗЫ
    function getMoscowDate() {
        const opt = { timeZone: "Europe/Moscow", day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false };
        return new Date().toLocaleString("ru-RU", opt).replace(', ', ' (').replace(',', ' (') + ')';
    }

    const token = new URLSearchParams(window.location.search).get('token');
    if (token) {
        db.collection("pending_registrations").doc(token).get().then(doc => {
            if (doc.exists) {
                const data = doc.data();
                auth.createUserWithEmailAndPassword(data.email, data.pass).then(cred => {
                    db.collection("users").doc(cred.user.uid).set({
                        nickname: data.nick,
                        email: data.email,
                        credits: 0,
                        subscription: "Нет",
                        reg_date: getMoscowDate(),
                        avatar_id: 1
                    }).then(() => {
                        db.collection("pending_registrations").doc(token).delete();
                        // ВСЁ. НИКАКИХ ПЕРЕХОДОВ. ПРОСТО ТЕКСТ.
                        document.getElementById('status-msg').innerText = "SUCCESSFULLY VERIFIED";
                        document.getElementById('status-sub').innerText = "Return to the desktop app. You can close this tab.";
                    });
                }).catch(e => {
                    document.getElementById('status-msg').innerText = "LINK USED";
                    document.getElementById('status-sub').innerText = e.message;
                });
            }
        });
    }
</script>